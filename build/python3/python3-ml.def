Bootstrap: library
From: ubuntu:16.04

%post
	WORKDIR=/singularity-build	# Full path to directory where Python and Singularity repo should be installed in container
	PY2VER=2.7.16			# Python 2 version
	PY3VER=3.7.3			# Python 3 version

	# Python packages to install inside of the container
	# Note: Separate packages by a comma in a string. This is a workaround to creating a bash array (this section executes with /bin/sh, not bash)
	PACKAGES="matplotlib, numpy, pandas, tensorflow, scikit-learn" 
	#PACKAGES="(matplotlib numpy pandas tensorflow scikit-learn)"
	
	if [ ! -d "$WORKDIR" ]; then
		mkdir $WORKDIR
	fi
	
	cd $WORKDIR

	apt-get update && apt-get -y upgrade

	# Install basic packages
	apt-get install -y build-essential software-properties-common \
		curl git htop man unzip vim wget nano gcc python3-setuptools
	
	# Get Singularity directory
	git clone https://github.com/hopehpc/singularity.git	
	cd singularity/build/python3/scripts

	# Run install-python.sh
	bash install-python.sh $PY2VER $PY3VER $WORKDIR

	# Run install-packages.sh
	bash install-packages.sh $PACKAGES

	# Install CUDA Toolkit
    wget https://developer.nvidia.com/compute/cuda/10.1/Prod/local_installers/cuda-repo-ubuntu1604-10-1-local-10.1.168-418.67_1.0-1_amd64.deb
    dpkg -i cuda-repo-ubuntu1604-10-1-local-10.1.168-418.67_1.0-1_amd64.deb
    apt-key add /var/cuda-repo-10-1-local-10.1.168-418.67/7fa2af80.pub
    apt-get update -y
    apt-get install -y --no-install-recommends cuda

%runscript
	python3	# Default to Python 3 
